---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
  namespace: data
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: homer
      version: 4.1.1
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  values:
    controllerType: deployment
    strategy:
      type: Recreate
    image:
      repository: b4bz/homer
      tag: 21.03.2
      pullPolicy: IfNotPresent
    env:
      TZ: Europe/Paris
    service:
      port:
        port: 8080
        annotations:
          prometheus.io/probe: "true"
          prometheus.io/protocol: http
    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: "nginx"
      nginx.ingress.kubernetes.io/auth-url: "http://authelia.auth.svc.cluster.local/api/verify"
      nginx.ingress.kubernetes.io/auth-signin: "https://login.k3s.xpander.ovh/"
    hosts:
      - host: homer.k3s.xpander.ovh
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - "homer.k3s.xpander.ovh"

    persistence:
      config:
        enabled: false
    resources:
      requests:
        cpu: 50m
        memory: 256Mi
    additionalVolumeMounts:
      - name: config
        mountPath: /www/config.yml
        subPath: config.yaml
      - name: assets-logo
        mountPath: /www/assets/logo.png
        subPath: logo.png
      - name: assets-sonarr
        mountPath: /www/assets/sonarr.png
        subPath: sonarr.png
      - name: assets-radarr
        mountPath: /www/assets/radarr.png
        subPath: radarr.png
      - name: assets-jackett
        mountPath: /www/assets/jackett.png
        subPath: jackett.png
      - name: assets-bazarr
        mountPath: /www/assets/bazarr.png
        subPath: bazarr.png
      - name: assets-jellyfin
        mountPath: /www/assets/jellyfin.png
        subPath: jellyfin.png
      - name: assets-qbittorrent
        mountPath: /www/assets/qbittorrent.png
        subPath: qbittorrent.png
      - name: assets-pyload
        mountPath: /www/assets/pyload.png
        subPath: pyload.png
      - name: assets-ubiquiti
        mountPath: /www/assets/ubiquiti.png
        subPath: ubiquiti.png
      - name: assets-pfsense
        mountPath: /www/assets/pfsense.png
        subPath: pfsense.png
      - name: assets-alertmanager
        mountPath: /www/assets/alertmanager.png
        subPath: alertmanager.png
      - name: assets-bookstack
        mountPath: /www/assets/bookstack.png
        subPath: bookstack.png
      - name: assets-freshrss
        mountPath: /www/assets/freshrss.png
        subPath: freshrss.png
      - name: assets-grocy
        mountPath: /www/assets/grocy.png
        subPath: grocy.png
      - name: assets-travelstories
        mountPath: /www/assets/travelstories.png
        subPath: travelstories.png
      - name: assets-wallabag
        mountPath: /www/assets/wallabag.png
        subPath: wallabag.png
      - name: assets-truenas
        mountPath: /www/assets/truenas.png
        subPath: truenas.png
      - name: assets-lychee
        mountPath: /www/assets/lychee.png
        subPath: lychee.png
      - name: assets-nextcloud
        mountPath: /www/assets/nextcloud.png
        subPath: nextcloud.png
      - name: assets-resilio-sync
        mountPath: /www/assets/resilio-sync.png
        subPath: resilio-sync.png
      - name: assets-goldilocks
        mountPath: /www/assets/goldilocks.png
        subPath: goldilocks.png
      - name: assets-sharry
        mountPath: /www/assets/sharry.png
        subPath: sharry.png
      - name: assets-grafana
        mountPath: /www/assets/grafana.png
        subPath: grafana.png
      - name: assets-gitea
        mountPath: /www/assets/gitea.png
        subPath: gitea.png
      - name: assets-healthchecks
        mountPath: /www/assets/healthchecks.png
        subPath: healthchecks.png
      - name: assets-ciao
        mountPath: /www/assets/ciao.png
        subPath: ciao.png
      - name: assets-snibox
        mountPath: /www/assets/snibox.png
        subPath: snibox.png
      - name: assets-navidrome
        mountPath: /www/assets/navidrome.png
        subPath: navidrome.png
      - name: assets-longhorn
        mountPath: /www/assets/longhorn.png
        subPath: longhorn.png
      - name: assets-kubernetes
        mountPath: /www/assets/kubernetes.png
        subPath: kubernetes.png
      - name: assets-tinyfilemanager
        mountPath: /www/assets/tinyfilemanager.png
        subPath: tinyfilemanager.png
      - name: assets-tdarr
        mountPath: /www/assets/tdarr.png
        subPath: tdarr.png
      - name: assets-recipes
        mountPath: /www/assets/recipes.png
        subPath: recipes.png
      - name: assets-reactive-resume
        mountPath: /www/assets/reactive-resume.png
        subPath: reactive-resume.png
      - name: assets-bitwarden
        mountPath: /www/assets/bitwarden.png
        subPath: bitwarden.png
      - name: assets-minio
        mountPath: /www/assets/minio.png
        subPath: minio.png
      - name: assets-prometheus
        mountPath: /www/assets/prometheus.png
        subPath: prometheus.png
      - name: assets-homeassistant
        mountPath: /www/assets/homeassistant.png
        subPath: homeassistant.png
      - name: assets-paperless
        mountPath: /www/assets/paperless.png
        subPath: paperless.png
      - name: assets-searx
        mountPath: /www/assets/searx.png
        subPath: searx.png
      - name: assets-drone
        mountPath: /www/assets/drone.png
        subPath: drone.png
      - name: assets-authelia
        mountPath: /www/assets/authelia.png
        subPath: authelia.png
      - name: assets-papermerge
        mountPath: /www/assets/papermerge.png
        subPath: papermerge.png
      - name: assets-taskcafe
        mountPath: /www/assets/taskcafe.png
        subPath: taskcafe.png
    additionalVolumes:
      - name: config
        configMap:
          name: homer-config
      - name: assets-logo
        configMap:
          name: homer-logo.png
      - name: assets-sonarr
        configMap:
          name: homer-sonarr.png
      - name: assets-radarr
        configMap:
          name: homer-radarr.png
      - name: assets-jackett
        configMap:
          name: homer-jackett.png
      - name: assets-bazarr
        configMap:
          name: homer-bazarr.png
      - name: assets-jellyfin
        configMap:
          name: homer-jellyfin.png
      - name: assets-pyload
        configMap:
          name: homer-pyload.png
      - name: assets-qbittorrent
        configMap:
          name: homer-qbittorrent.png
      - name: assets-ubiquiti
        configMap:
          name: homer-ubiquiti.png
      - name: assets-pfsense
        configMap:
          name: homer-pfsense.png
      - name: assets-alertmanager
        configMap:
          name: homer-alertmanager.png
      - name: assets-bookstack
        configMap:
          name: homer-bookstack.png
      - name: assets-freshrss
        configMap:
          name: homer-freshrss.png
      - name: assets-grocy
        configMap:
          name: homer-grocy.png
      - name: assets-travelstories
        configMap:
          name: homer-travelstories.png
      - name: assets-wallabag
        configMap:
          name: homer-wallabag.png
      - name: assets-truenas
        configMap:
          name: homer-truenas.png
      - name: assets-lychee
        configMap:
          name: homer-lychee.png
      - name: assets-nextcloud
        configMap:
          name: homer-nextcloud.png
      - name: assets-resilio-sync
        configMap:
          name: homer-resilio-sync.png
      - name: assets-goldilocks
        configMap:
          name: homer-goldilocks.png
      - name: assets-sharry
        configMap:
          name: homer-sharry.png
      - name: assets-grafana
        configMap:
          name: homer-grafana.png
      - name: assets-gitea
        configMap:
          name: homer-gitea.png
      - name: assets-healthchecks
        configMap:
          name: homer-healthchecks.png
      - name: assets-ciao
        configMap:
          name: homer-ciao.png
      - name: assets-snibox
        configMap:
          name: homer-snibox.png
      - name: assets-navidrome
        configMap:
          name: homer-navidrome.png
      - name: assets-longhorn
        configMap:
          name: homer-longhorn.png
      - name: assets-kubernetes
        configMap:
          name: homer-kubernetes.png
      - name: assets-tinyfilemanager
        configMap:
          name: homer-tinyfilemanager.png
      - name: assets-tdarr
        configMap:
          name: homer-tdarr.png
      - name: assets-recipes
        configMap:
          name: homer-recipes.png
      - name: assets-reactive-resume
        configMap:
          name: homer-reactive-resume.png
      - name: assets-bitwarden
        configMap:
          name: homer-bitwarden.png
      - name: assets-minio
        configMap:
          name: homer-minio.png
      - name: assets-prometheus
        configMap:
          name: homer-prometheus.png
      - name: assets-homeassistant
        configMap:
          name: homer-homeassistant.png
      - name: assets-paperless
        configMap:
          name: homer-paperless.png
      - name: assets-searx
        configMap:
          name: homer-searx.png
      - name: assets-drone
        configMap:
          name: homer-drone.png
      - name: assets-authelia
        configMap:
          name: homer-authelia.png
      - name: assets-papermerge
        configMap:
          name: homer-papermerge.png
      - name: assets-taskcafe
        configMap:
          name: homer-taskcafe.png
